<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chris's Notes - Master Your Physics Tests</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS for Inter font and smooth scrolling */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }

        /* Custom gradient for the hero section */
        .hero-gradient {
            /* Changed dark blue gradient to feel slightly more academic */
            background: linear-gradient(180deg, #0f172a 0%, #172554 100%);
        }

        /* Custom accent color: Academic Blue (#4299e1) */
        .text-accent {
            color: #4299e1;
        }

        .bg-accent {
            background-color: #4299e1;
        }

        .border-accent {
            border-color: #4299e1;
        }

        /* Ensure links look and act like buttons */
        .paypal-btn {
            font-weight: 700;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.3s;
            display: block;
            text-align: center;
        }
    </style>

    <!-- Removed PayPal SDK script to ensure buttons render reliably through simple redirection -->
</head>

<body class="bg-gray-900 text-gray-100">

    <!-- Navigation Bar -->
    <nav class="sticky top-0 z-50 bg-gray-800/90 backdrop-blur-sm shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <a href="#home" class="text-2xl font-bold text-accent">Chris's Notes</a>

                <!-- Navigation Links (Desktop) -->
                <div class="hidden md:flex space-x-8">
                    <a href="#features" class="text-gray-300 hover:text-accent transition duration-300">Benefits</a>
                    <a href="#pricing" class="text-gray-300 hover:text-accent transition duration-300">Pricing</a>
                    <a href="#llm-tutor" class="text-gray-300 hover:text-accent transition duration-300">Quick
                        Assist</a>
                    <a href="#testimonials" class="text-gray-300 hover:text-accent transition duration-300">Reviews</a>
                    <a href="#pricing"
                        class="bg-accent text-gray-900 px-4 py-2 rounded-lg font-semibold hover:bg-blue-400 transition duration-300 shadow-md">Buy
                        Now</a>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-button" class="md:hidden text-gray-300 hover:text-accent focus:outline-none">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu (Hidden by default) -->
        <div id="mobile-menu" class="hidden md:hidden bg-gray-800/95">
            <a href="#features" class="block px-4 py-2 text-gray-300 hover:bg-gray-700">Benefits</a>
            <a href="#pricing" class="block px-4 py-2 text-gray-300 hover:bg-gray-700">Pricing</a>
            <a href="#llm-tutor" class="block px-4 py-2 text-gray-300 hover:bg-gray-700">Quick Assist</a>
            <a href="#testimonials" class="block px-4 py-2 text-gray-300 hover:bg-gray-700">Reviews</a>
            <a href="#pricing"
                class="block px-4 py-3 bg-accent text-gray-900 font-semibold text-center hover:bg-blue-400 transition duration-300">Buy
                Now</a>
        </div>
    </nav>

    <main>
        <!-- Hero Section -->
        <section id="home" class="hero-gradient py-20 sm:py-32">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h1 class="text-4xl sm:text-6xl font-extrabold tracking-tight mb-6">
                    Master <span class="text-accent">Physics Tests</span> with Chris's Notes
                </h1>
                <p class="text-xl text-gray-400 max-w-3xl mx-auto mb-10">
                    Stop stressing about complex formulas and theory. Get instant access to perfectly organized notes,
                    study guides, and practice tests that guarantee better scores.
                </p>
                <div class="flex justify-center space-x-4">
                    <a href="#pricing"
                        class="bg-accent text-gray-900 px-8 py-3 rounded-xl text-lg font-bold hover:shadow-xl hover:opacity-90 transition duration-300 transform hover:scale-105 shadow-2xl shadow-blue-500/50">
                        View Basic Notes ($1)
                    </a>
                    <a href="#features"
                        class="border border-gray-500 text-gray-300 px-8 py-3 rounded-xl text-lg font-medium hover:bg-gray-800 transition duration-300 transform hover:scale-105">
                        Browse Topics
                    </a>
                </div>

                <!-- Mockup Image Placeholder -->
                <div class="mt-16">
                    <div class="bg-gray-800 rounded-xl shadow-2xl p-4 md:p-10 border border-gray-700 mx-auto max-w-5xl">
                        <img src="https://placehold.co/1000x500/1f2937/d1d5db?text=Chris's+Notes+Study+Guide+Preview" alt="Chris's Notes Study Guide Preview" class="rounded-lg border border-gray-700 shadow-xl">
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section (Now Study Benefits) -->
        <section id="features" class="py-20 bg-gray-900">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-bold text-center mb-4">Study Guide Benefits</h2>
                <p class="text-center text-gray-400 mb-16 max-w-2xl mx-auto">Every guide is crafted by a top-scoring
                    physics student to ensure clarity and relevance to your actual tests.</p>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-10">

                    <!-- Benefit 1: Clear Concept Breakdown -->
                    <div
                        class="bg-gray-800 p-8 rounded-xl shadow-lg border-t-4 border-accent transition duration-300 hover:shadow-2xl">
                        <div class="text-accent mb-4">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">Clear Concept Breakdown</h3>
                        <p class="text-gray-400">Complex theories and dense chapters are distilled into clear,
                            digestible, step-by-step explanations and annotated diagrams.</p>
                    </div>

                    <!-- Benefit 2: Focused Test Practice -->
                    <div
                        class="bg-gray-800 p-8 rounded-xl shadow-lg border-t-4 border-accent transition duration-300 hover:shadow-2xl">
                        <div class="text-accent mb-4">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.477 3-10S13.657 3 12 3m0 18c-1.657 0-3-4.477-3-10S10.343 3 12 3m0 18v-9">
                                </path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">Focused Test Practice</h3>
                        <p class="text-gray-400">Practice problems selected specifically to mirror actual test questions
                            and target common conceptual pitfalls.</p>
                    </div>

                    <!-- Benefit 3: Expert Tips & Tricks -->
                    <div
                        class="bg-gray-800 p-8 rounded-xl shadow-lg border-t-4 border-accent transition duration-300 hover:shadow-2xl">
                        <div class="text-accent mb-4">
                            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2l4-4m5.618-4.016A11.955 11.955 0 0112 2.944a12.004 12.004 0 012.28 15.548M2.99 17.58A11.955 11.955 0 0012 21.055a12.004 12.004 0 00-2.28-15.548">
                                </path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold mb-3">Expert Tips & Tricks</h3>
                        <p class="text-gray-400">Learn the study habits, mnemonics, and test-taking strategies used by
                            top-scoring students to maximize your exam performance.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section (Now Reviews) -->
        <section id="testimonials" class="py-20 bg-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <h2 class="text-4xl font-bold text-center mb-12">Loved by Top-Scoring Students</h2>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

                    <!-- Testimonial 1 -->
                    <div class="bg-gray-900 p-6 rounded-xl shadow-xl border border-gray-700">
                        <p class="text-lg italic text-gray-300 mb-4">
                            "I went from a C to an A- on my midterm after using these guides for two weeks. The
                            structure is perfect and easy to follow."
                        </p>
                        <div class="flex items-center">
                            <img src="https://placehold.co/50x50/374151/ffffff?text=MC" alt="Maya C." class="rounded-full mr-4 border-2 border-accent">
                            <div>
                                <p class="font-semibold text-white">Maya Chen</p>
                                <p class="text-sm text-gray-400">10th Grade Student</p>
                            </div>
                        </div>
                    </div>

                    <!-- Testimonial 2 -->
                    <div class="bg-gray-900 p-6 rounded-xl shadow-xl border border-gray-700">
                        <p class="text-lg italic text-gray-300 mb-4">
                            "Finally, I understand electromagnetism! The concept breakdown section saved my grade.
                            Highly recommend this for finals prep."
                        </p>
                        <div class="flex items-center">
                            <img src="https://placehold.co/50x50/374151/ffffff?text=OH" alt="Omar H." class="rounded-full mr-4 border-2 border-accent">
                            <div>
                                <p class="font-semibold text-white">Omar Hassan</p>
                                <p class="text-sm text-gray-400">High School Physics Club President</p>
                            </div>
                        </div>
                    </div>

                    <!-- Testimonial 3 -->
                    <div class="bg-gray-900 p-6 rounded-xl shadow-xl border border-gray-700 hidden lg:block">
                        <p class="text-lg italic text-gray-300 mb-4">
                            "Worth every penny. The advanced problem sets were exactly the kind of challenging material
                            I needed to ace the AP exam."
                        </p>
                        <div class="flex items-center">
                            <img src="https://placehold.co/50x50/374151/ffffff?text=KW" alt="Kevin W." class="rounded-full mr-4 border-2 border-accent">
                            <div>
                                <p class="font-semibold text-white">Kevin Williams</p>
                                <p class="text-sm text-gray-400">University Physics Major</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- Pricing Section & CTA -->
        <section id="pricing" class="py-20 bg-gray-900">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-bold mb-4">Get the Study Guide You Need</h2>
                <p class="text-xl text-gray-400 max-w-2xl mx-auto mb-16">Instant access to downloadable PDF study guides
                    for immediate learning.</p>

                <!-- Payment Note -->
                <div class="max-w-2xl mx-auto mb-10 p-4 bg-blue-900/50 border border-blue-700 rounded-xl text-blue-300">
                    <p class="font-semibold">🔗 Checkout Link Structure:</p>
                    <p class="text-sm">These buttons redirect to a placeholder URL in a new tab, simulating a real
                        PayPal or Stripe checkout page. **To go live, replace the `href` URL with your actual hosted
                        payment link.**</p>
                </div>


                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 items-stretch">

                    <!-- Plan 1: Basic Concepts ($1.00) -->
                    <div
                        class="bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700 flex flex-col justify-between transition duration-300 hover:scale-[1.02]">
                        <div>
                            <h3 class="text-2xl font-bold mb-4 text-white">Basic Concepts</h3>
                            <p class="text-gray-400 mb-6">Fundamental concepts review for a solid foundation.</p>
                            <p class="text-5xl font-extrabold mb-8 text-accent">$1.00</p>
                            <ul class="text-left space-y-3 mb-10 text-gray-300">
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Essentials
                                    Concepts Review</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Key Formula
                                    Sheet (PDF)</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Simple
                                    Diagrams & Notation</li>
                                <li class="flex items-center"><span class="text-gray-500 mr-2">&#10005;</span> Advanced
                                    Problem Sets</li>
                            </ul>
                        </div>
                        <!-- PayPal Button 1 (Redirect Link) -->
                        <a href="https://example.com/checkout?product=Basic&price=1.00" target="_blank"
                            class="w-full bg-accent text-gray-900 rounded-lg text-lg hover:bg-blue-400 transition duration-300 shadow-xl shadow-blue-500/50 paypal-btn">
                            Pay with PayPal ($1.00)
                        </a>
                    </div>

                    <!-- Plan 2: Advanced Problem Sets ($2.99) -->
                    <div
                        class="bg-gray-900 p-8 rounded-xl shadow-2xl border-4 border-accent transform scale-100 md:scale-[1.05] flex flex-col justify-between transition duration-300 hover:scale-[1.07] relative">
                        <span class="absolute top-0 right-0 -mt-4 mr-4 bg-accent text-gray-900 text-xs font-bold uppercase px-3 py-1 rounded-full shadow-lg">Most Popular</span>
                        <div>
                            <h3 class="text-3xl font-bold mb-4 text-accent">Advanced Problem Sets</h3>
                            <p class="text-gray-300 mb-6">Challenging practice for high grades and competitive exams.
                            </p>
                            <p class="text-6xl font-extrabold mb-8 text-white">$2.99</p>
                            <ul class="text-left space-y-3 mb-10 text-gray-200">
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Full
                                    Problem Set Archive</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Detailed
                                    Solution Walkthroughs</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> **Expert
                                    Test-Taking Tips**</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Covers
                                    Complex Topics</li>
                            </ul>
                        </div>
                        <!-- PayPal Button 2 (Redirect Link) -->
                        <a href="https://example.com/checkout?product=Advanced&price=2.99" target="_blank"
                            class="w-full bg-accent text-gray-900 rounded-lg text-lg hover:bg-blue-400 transition duration-300 shadow-xl shadow-blue-500/50 paypal-btn">
                            Pay with PayPal ($2.99)
                        </a>
                    </div>

                    <!-- Plan 3: Everything Bundle ($3.99) -->
                    <div
                        class="bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700 flex flex-col justify-between transition duration-300 hover:scale-[1.02]">
                        <div>
                            <h3 class="text-2xl font-bold mb-4 text-white">Everything Bundle</h3>
                            <p class="text-gray-400 mb-6">Get all the current content plus future updates.</p>
                            <p class="text-5xl font-extrabold mb-8 text-accent">$3.99</p>
                            <ul class="text-left space-y-3 mb-10 text-gray-300">
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Includes
                                    Basic and Advanced Guides</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> All Future
                                    Updates Included</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Printable
                                    Workbook Layout</li>
                                <li class="flex items-center"><span class="text-accent mr-2">&#10003;</span> Lifetime
                                    Access</li>
                            </ul>
                        </div>
                        <!-- PayPal Button 3 (Redirect Link) -->
                        <a href="https://example.com/checkout?product=Bundle&price=3.99" target="_blank"
                            class="w-full bg-accent text-gray-900 rounded-lg text-lg hover:bg-blue-400 transition duration-300 shadow-xl shadow-blue-500/50 paypal-btn">
                            Pay with PayPal ($3.99)
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- --- GEMINI API INTEGRATION: PHYSICS QUICK ASSIST --- -->
        <section id="llm-tutor" class="py-20 bg-gray-800">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <h2 class="text-4xl font-bold mb-4 flex items-center justify-center space-x-3">
                    <span class="text-accent">Physics Quick Assist</span> <span class="text-yellow-400">✨</span>
                </h2>
                <p class="text-xl text-gray-400 max-w-2xl mx-auto mb-10">
                    Try out our instant, AI-powered Physics Tutor! Ask any question or provide a complex problem for a
                    grounded, expert answer.
                </p>

                <!-- Input Area -->
                <div class="bg-gray-900 p-6 rounded-xl shadow-2xl border border-gray-700 mb-8">
                    <textarea id="physics-query" rows="4" class="w-full bg-gray-700 text-gray-100 p-4 rounded-lg border border-gray-600 focus:ring-accent focus:border-accent resize-none placeholder-gray-400" placeholder="e.g., Explain the photoelectric effect or calculate the force required to move a 10 kg mass at 5 m/s²." required></textarea>

                    <button id="ask-tutor-button" class="w-full mt-4 bg-accent text-gray-900 py-3 rounded-lg text-lg font-bold hover:bg-blue-400 transition duration-300 transform hover:scale-[1.01] flex items-center justify-center space-x-2">
                        <span>Get Instant Expert Answer ✨</span>
                        <svg id="loading-spinner" class="animate-spin h-5 w-5 text-gray-900 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </button>
                </div>

                <!-- Output Area -->
                <div id="tutor-response-container" class="mt-8 text-left hidden">
                    <h3 class="text-2xl font-bold text-accent mb-4 border-b border-gray-700 pb-2">Chris's Assistant
                        Says:</h3>
                    <div id="tutor-response"
                        class="bg-gray-900 p-6 rounded-xl shadow-xl border border-gray-700 text-gray-300 leading-relaxed whitespace-pre-wrap">
                        <!-- AI Response will be injected here -->
                    </div>
                    <!-- Source Citations (if any) -->
                    <div id="tutor-sources" class="mt-4 text-sm text-gray-500">
                        <!-- Citations will be injected here -->
                    </div>
                </div>
            </div>
        </section>
        <!-- --- END GEMINI API INTEGRATION --- -->

        <!-- Footer -->
        <footer class="bg-gray-900 border-t border-gray-800 py-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="md:flex md:justify-between md:items-center">
                    <div class="mb-6 md:mb-0">
                        <a href="#home" class="text-2xl font-bold text-accent">Chris's Notes</a>
                        <p class="text-gray-400 mt-2 text-sm">&copy; 2025 Chris's Notes. All rights reserved.</p>
                    </div>
                    <div class="flex space-x-6">
                        <a href="#" class="text-gray-400 hover:text-accent transition duration-300">Terms of Service</a>
                        <a href="#" class="text-gray-400 hover:text-accent transition duration-300">Privacy Policy</a>
                        <a href="#" class="text-gray-400 hover:text-accent transition duration-300">Contact</a>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Custom Notification Message Box (Replaces alert/confirm) -->
        <div id="notification-box"
            class="fixed top-5 right-5 z-[100] p-4 rounded-xl shadow-xl max-w-sm w-full transition-transform duration-500 transform translate-x-full"
            style="opacity: 0;">
            <p id="notification-message" class="font-semibold"></p>
        </div>
    </main>


    <!-- JavaScript for Mobile Menu Toggle and Gemini API Integration -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Mobile Menu Logic ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            const navLinks = document.querySelectorAll('nav a');

            mobileMenuButton.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
            });

            navLinks.forEach(link => {
                link.addEventListener('click', () => {
                    if (!mobileMenu.classList.contains('hidden')) {
                         mobileMenu.classList.add('hidden');
                    }
                });
            });

            // --- Notification Logic ---
            const notificationBox = document.getElementById('notification-box');
            const notificationMessage = document.getElementById('notification-message');

            function showNotification(message, type = 'info') {
                notificationMessage.textContent = message;
                notificationBox.className = 'fixed top-5 right-5 z-[100] p-4 rounded-xl shadow-xl max-w-sm w-full transition-transform duration-500 transform translate-x-0';
                notificationBox.style.opacity = 1;

                if (type === 'success') {
                    notificationBox.classList.add('bg-green-600', 'text-white');
                    notificationBox.classList.remove('bg-red-600', 'bg-gray-700');
                } else if (type === 'error') {
                    notificationBox.classList.add('bg-red-600', 'text-white');
                    notificationBox.classList.remove('bg-green-600', 'bg-gray-700');
                } else {
                    notificationBox.classList.add('bg-gray-700', 'text-gray-100');
                    notificationBox.classList.remove('bg-green-600', 'bg-red-600');
                }

                setTimeout(() => {
                    notificationBox.classList.remove('translate-x-0');
                    notificationBox.classList.add('translate-x-full');
                    notificationBox.style.opacity = 0;
                }, 5000);
            }


            // --- Gemini API Integration Logic ---

            const askButton = document.getElementById('ask-tutor-button');
            const queryInput = document.getElementById('physics-query');
            const responseContainer = document.getElementById('tutor-response-container');
            const responseDiv = document.getElementById('tutor-response');
            const sourcesDiv = document.getElementById('tutor-sources');
            const loadingSpinner = document.getElementById('loading-spinner');

            const modelName = "gemini-2.5-flash-preview-05-20";
            const apiKey = ""; // API key will be provided by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;
            const maxRetries = 3;
            const baseDelay = 1000; // 1 second

            /**
             * Handles the API call to the Gemini model with exponential backoff.
             * @param {string} userQuery - The question to ask the tutor.
             */
            async function callGeminiAPI(userQuery) {
                const systemPrompt = "You are an expert Physics Tutor named 'Chris's Assistant'. Your goal is to provide concise, accurate, and easy-to-understand explanations for physics concepts or step-by-step solutions to physics problems. Always use proper LaTeX formatting for formulas and equations (e.g., wrap in $ or $$). Be encouraging and keep the response professional but friendly. Limit your response to 150 words.";

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }], // Enable grounding for current, accurate info
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.status === 429 && i < maxRetries - 1) {
                            // Rate limit exceeded, retry with exponential backoff
                            const delay = baseDelay * Math.pow(2, i) + Math.random() * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                            continue;
                        }

                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }

                        const result = await response.json();
                        const candidate = result.candidates?.[0];

                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const text = candidate.content.parts[0].text;
                            
                            // Extract grounding sources
                            let sources = [];
                            const groundingMetadata = candidate.groundingMetadata;
                            if (groundingMetadata && groundingMetadata.groundingAttributions) {
                                sources = groundingMetadata.groundingAttributions
                                    .map(attribution => ({
                                        uri: attribution.web?.uri,
                                        title: attribution.web?.title,
                                    }))
                                    .filter(source => source.uri && source.title); // Ensure sources are valid
                            }

                            return { text, sources };

                        } else {
                            throw new Error("Response structure is missing content.");
                        }

                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed:`, error);
                    }
                }
                throw new Error("Failed to get response from AI tutor after multiple retries.");
            }
            
            // --- Event Listener for Button Click ---
            askButton.addEventListener('click', async () => {
                const query = queryInput.value.trim();
                if (query.length < 5) {
                    showNotification('Please enter a longer, more specific physics question.', 'info');
                    return;
                }

                // UI feedback: Start loading
                askButton.disabled = true;
                askButton.classList.add('opacity-50');
                loadingSpinner.classList.remove('hidden');
                responseContainer.classList.add('hidden');
                responseDiv.innerHTML = '';
                sourcesDiv.innerHTML = '';

                try {
                    const { text, sources } = await callGeminiAPI(query);
                    
                    // Display response
                    responseDiv.innerHTML = text; 
                    responseContainer.classList.remove('hidden');

                    // Display sources
                    if (sources.length > 0) {
                        const uniqueSources = Array.from(new Set(sources.map(s => s.uri)))
                            .map(uri => sources.find(s => s.uri === uri));

                        let sourceHtml = '<p class="font-semibold">Sources:</p><ul class="list-disc pl-5 space-y-1">';
                        uniqueSources.forEach((source, index) => {
                            // Use index + 1 for simple citation numbering
                            sourceHtml += `<li><a href="${source.uri}" target="_blank" class="text-accent hover:underline" title="${source.title}">${source.title || source.uri}</a></li>`;
                        });
                        sourceHtml += '</ul>';
                        sourcesDiv.innerHTML = sourceHtml;
                    } else {
                         sourcesDiv.innerHTML = '<p class="text-gray-600">No specific sources cited for this general explanation.</p>';
                    }

                } catch (error) {
                    console.error("Gemini Tutor Error:", error);
                    responseDiv.textContent = 'Oops! The expert tutor encountered an error. Please try a different question.';
                    responseContainer.classList.remove('hidden');
                    sourcesDiv.innerHTML = '';
                    showNotification('Error retrieving answer.', 'error');
                } finally {
                    // UI feedback: End loading
                    askButton.disabled = false;
                    askButton.classList.remove('opacity-50');
                    loadingSpinner.classList.add('hidden');
                }
            });

        });
    </script>

</body>

</html>
